<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/iron-collapse/iron-collapse.html">
<link rel="import" href="../../vendor/iron-icons/iron-icons.html">
<link rel="import" href="../../vendor/paper-item/paper-icon-item.html">
<link rel="import" href="../../vendor/paper-item/paper-item-body.html">
<link rel="import" href="../../vendor/paper-button/paper-button.html">
<link rel="import" href="../../vendor/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../vendor/paper-badge/paper-badge.html">
<link rel="import" href="../../vendor/paper-dialog/paper-dialog.html">
<link rel="import" href="../../vendor/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../vendor/paper-input/paper-input.html">
<link rel="import" href="../../vendor/paper-input/paper-textarea.html">
<link rel="import" href="../../vendor/paper-styles/default-theme.html">
<link rel="import" href="bde-compound-creator.html">
<link rel="import" href="bde-explorer-details.html">
<!--
`bde-explorer` is the management component for handling cubble packages

Example:

    <bde-explorer></bde-explorer>

@damo demo/index.html
-->
<dom-module id="bde-explorer">
  <template>
    <style>
      :host {
        display: block;
      }
      .container {
          margin-top: 15px;
          cursor: pointer;
      }
      .container:focus {
          outline: 0;
      }
      .container > span {
          color: var(--bde-explorer-heading-text-color, --primary-text-color);

          @apply(--paper-font-body2);
      }
      .container > .count {
          color: var(--secondary-text-color);

          @apply(--paper-font-caption);
      }
      .addItem {
          cursor: pointer;
      }
      paper-button {
          width: 90%;
          margin: 2em 5% 0;
          background-color: var(--primary-background-color);
      }
  </style>

  <bde-compound-creator id="compoundCreator"
    opened="{{_compoundCreatorOpened}}"
    on-last-artifact-changed="_handleNewCompound"></bde-compound-creator>

    <div class="container" tabindex="0">
      <span>CompoundComponents</span>
      <span class="count">([[artifacts.compoundComponents.length]])</span>
    </div>

    <template is="dom-repeat" id="compoundList"
      items="{{artifacts}}" filter="isCompound" as="compound">
      <paper-icon-item on-tap="selectCompound" toggles>
        <iron-icon icon="icons:donut-small" item-icon></iron-icon>
        <paper-item-body three-line>
          <div>[[compound.artifactId]]</div>
          <div secondary>[[compound.description]]</div>
          <div secondary>[[compound.members.length]] Member(s)</div>
        </paper-item-body>
        <paper-icon-button icon="icons:settings" alt="Settings" on-tap="_settingsButton">
        </paper-icon-button>
      </paper-icon-item>
    </template>

    <paper-button active="{{_compoundCreatorOpened}}" toggles raised>
      <iron-icon icon="icons:add"></iron-icon>
      Add new compound...
    </paper-button>

    <array-selector id="compoundSelector"
      items="{{artifacts}}"
      selected="{{selectedArtifact}}">
    </array-selector>

  </template>
  <script>
  Polymer({
    is: 'bde-explorer',

    properties: {

      webpackage: {
        type: Object,
        notify: true
      },

      selectedArtifact: {
        type: Object,
        notify: true
      }
    },

    observers: [
      '_webpackageChanged(webpackage)'
    ],

    isCompound: function(artifact) {
      return artifact.is === 'compound';
    },

    selectCompound: function(event) {
      var item = this.$.compoundList.itemForElement(event.target);
      this.$.compoundSelector.select(item);
      this.fire('iron-select', { item: item });
    },

    _handleNewCompound: function(event) {
      var item, artifact = event.detail.value;
      artifact.is = 'compound';
      this.push('artifacts', artifact);
    },

    _webpackageChanged: function(newWebpackage, oldWebpackage) {
      console.log(newWebpackage, oldWebpackage);
    }
  });
  </script>
</dom-module>