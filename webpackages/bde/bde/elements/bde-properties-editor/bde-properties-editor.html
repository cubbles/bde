<link rel="import" href="../../vendor/polymer/polymer.html"/>
<link rel="import" href="../../vendor/iron-icons/iron-icons.html">
<link rel="import" href="../../vendor/paper-styles/paper-styles.html">
<link rel="import" href="../../vendor/paper-item/paper-item.html">
<link rel="import" href="../../vendor/paper-item/paper-icon-item.html">
<link rel="import" href="../../vendor/paper-item/paper-item-body.html">

<link rel="import" href="../bde-styles/bde-custom-icons.html">
<link rel="import" href="bde-member-info.html">

<!--
Property Editor for the BDE application.

bde-properties-editor gets the currently selected element in the bde and
shows information about it.

Furthermore certain properties of an element can be altered and certain
actions can be performed on said element.

### Usage in BDE
@todo Create example usage

@package Webble TAG BDE
@author Felix DÃ¼rrwald <felix.duerrwald@hm-ag.de>
-->
<dom-module id="bde-properties-editor">

    <style>
    :host {
        display: block;
    }

    paper-icon-item {
        margin-bottom: 1em;

        @apply(--shadow-elevation-2dp);
    }

    </style>

    <template>
        <!-- Edit a single selected Member -->
        <div hidden$="[[!singleSelected]]">
            <bde-member-info id="inspector"
                artifact="{{artifact}}"
                member="{{lastSelectedMember}}"
            ></bde-member-info>
        </div>

        <!-- Multiple members are selected -->
        <div hidden$="[[singleSelected]]">
            <template is="dom-repeat" items="[[selectedMembers]]" as="member">
                <paper-icon-item elevation="2">
                    <iron-icon icon="[[_getIcon(member)]]" item-icon></iron-icon>
                    <paper-item-body three-line>
                        <div>[[_getMemberName(member)]]</div>
                        <div secondary>[[member.description]]</div>
                        <div secondary>[[_countInputSlots(member)]], [[_countOutputSlots(member)]]</div>
                    </paper-item-body>
                </paper-icon-item>
            </template>
        </div>

    </template>

</dom-module>

<script>
'use strict';

Polymer({
  is: 'bde-properties-editor',

  properties: {

    artifact: {
      type: Object,
      notify: true
    },

    manifest: {
      type: Object,
      notify: true
    },

    lastSelectedConnection: {
      type: Object,
      notify: true
    },

    lastSelectedMember: {
      type: Object,
      notify: true
    },

    resolutions: {
      type: Object,
      notify: true
    },

    selectedConnections: {
      type: Array
    },

    selectedMembers: {
      type: Array,
      notify: true
    },

    singleSelected: {
      type: Boolean,
      computed: 'singleSelection(selectedMembers.*)'
    }

  },

  observers: [
    '_selectedConnectionsChanged(selectedConnections.splices)',
    '_selectedMembersChanged(selectedMembers.splices)'
  ],

  singleSelection: function (members) {
    return (this.selectedMembers.length === 1);
  },

  _countInputSlots: function (member) {
    var count = 0;
    if (member && member.metadata) {
      count = member.metadata.slots.filter((slot) => !slot.direction || slot.direction.indexOf('input') > -1).length;
    }
    return count + ' input ' + ((count === 1) ? 'slot' : 'slots');
  },
  _countOutputSlots: function (member) {
    var count = 0;
    if (member && member.metadata) {
      count = member.metadata.slots.filter((slot) => !slot.direction || slot.direction.indexOf('output') > -1).length;
    }
    return count + ' output ' + ((count === 1) ? 'slot' : 'slots');
  },

  _getIcon: function (member) {
    return (member.metadata && member.metadata.icon) || 'cog';
  },

  _getMemberName: function (member) {
    return member.displayName || member.memberId;
  },

  _selectedConnectionsChanged: function (changeRecord) {

  },

  _selectedMembersChanged: function (changeRecord) {

  }

});
</script>
