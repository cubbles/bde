<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../vendor/iron-icons/iron-icons.html">
<link rel="import" href="../../vendor/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../vendor/paper-fab/paper-fab.html">

<link rel="import" href="../bde-graph/bde-graph.html">
<link rel="import" href="../bde-base-browser/bde-base-browser.html">
<link rel="import" href="../bde-properties-editor/bde-properties-editor.html">
<link rel="import" href="../../vendor/paper-tooltip/paper-tooltip.html">

<dom-module id="bde-dataflow-view">
  <template>
    <style>
      :host {
        position: relative;
        display: block;
      }

      #graph {
        @apply(--layout);
        @apply(--layout-vertical);

        width: 100%;
        height: 100%;
      }

      #toolbar {
        position: absolute;
        bottom: 1em;
        width: 100%;

        @apply(--layout-horizontal);
      }

      paper-fab {
        margin: 0 1em;
      }

      .tooltip {
          font-family: 'Roboto', 'Noto', sans-serif;
          font-size: 14px;
      }

      .flex {
        @apply(--layout-flex);
      }

      #addMemberButton {
        transition: transform ease-in-out 0.3s;
      }

      #addMemberButton.moveRight {
        transform: translate3d(calc(28px + 1em),0,0);

        @apply(--shadow-elevation-3dp);
      }

      #drawerPanel {
        --paper-drawer-panel-right-drawer-container: {
          background-color: var(--paper-grey-100);
          padding-left: 40px;
          padding-right: 20px;
          overflow-y: auto;
          z-index: 1;

          @apply(--shadow-elevation-2dp);
        };
      }




    </style>

    <!--<paper-dialog id="dialog" opened="{{dialogOpened}}" with-backdrop>-->

      <!--<h2>Add member</h2>-->

      <!--<paper-dialog-scrollable>-->

        <bde-base-browser id="browser"
          on-iron-selected="_addMember"
          settings="[[settings]]"
          manifest="[[currentComponentMetadata.manifest]]"
          current-component="[[_artifact]]"
        ></bde-base-browser>

      <!--</paper-dialog-scrollable>-->

      <!--<div class="buttons">-->
        <!--<paper-button dialog-dismiss>Close</paper-button>-->
      <!--</div>-->

    <!--</paper-dialog>-->

    <paper-drawer-panel id="drawerPanel"
      drawer-width="400px"
      right-drawer
      force-narrow="[[!showPropertyEditor]]"
      disable-swipe
      disable-edge-swipe>

      <div id="mainPanel" main>

        <bde-graph id="bdeGraph"
          graph="{{graph}}"
          width="[[_graphWidth]]"
          height="[[_graphHeight]]"
          offset-x="[[_graphOffsetX]]"
          offset-y="[[_graphOffsetY]]"
          theme="light"
          library="{{library}}"
          selected-nodes="{{_selectedNodes}}"
          selected-edges="{{_selectedEdges}}"
          last-selected-node="{{_lastSelectedNode}}"
          last-selected-edge="{{_lastSelectedEdge}}"
        ></bde-graph>

        <div id="toolbar">
          <paper-fab id="zoomToFit"
            icon="icons:aspect-ratio"
            on-tap="zoomToFit"
          ></paper-fab>
          <paper-tooltip for="zoomToFit" position="top">
                <div class="tooltip">Zoom to fit</div>
          </paper-tooltip>
          <paper-fab id="triggerAutolayout"
            icon="bde:magic-wand"
            on-tap="triggerAutolayout"
          ></paper-fab>
          <paper-tooltip for="triggerAutolayout" position="top">
                <div class="tooltip">Autolayout</div>
          </paper-tooltip>
          <div class="flex"></div>

          <paper-fab id="addMemberButton"
            class$="[[_addCubbleClass(showPropertyEditor)]]"
            icon="icons:add"
            on-tap="onAddMemberBtcClick">
          </paper-fab>
          <paper-tooltip for="addMemberButton" position="top">
                <div class="tooltip">Add member</div>
          </paper-tooltip>
        </div>


      </div>

      <div id="drawerPanel" drawer>

        <bde-properties-editor id="propertyEditor"
          artifact="{{_artifact}}"
          selected-members="[[selectedMembers]]"
          connections="[[selectedConnections]]"
          resolutions="[[resolutions]]"
          last-selected-member="[[lastSelectedMember]]"
          last-selected-connection={{lastSelectedConnection}}
        ></bde-properties-editor>

      </div>

    </paper-drawer-panel>

</template>
<!-- Fetch API polyfill -->
<script src="../../vendor/fetch/fetch.js"></script>
<script src="./bde-dataflow-view.js"></script>
</dom-module>
