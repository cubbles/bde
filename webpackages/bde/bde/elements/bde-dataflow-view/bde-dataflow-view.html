<link rel="import" href="../../vendor/polymer/polymer.html">
<link rel="import" href="../../vendor/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../vendor/iron-icons/iron-icons.html">
<link rel="import" href="../../vendor/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../vendor/paper-fab/paper-fab.html">

<link rel="import" href="../bde-graph/bde-graph.html">
<link rel="import" href="../bde-base-browser/bde-base-browser.html">
<link rel="import" href="../bde-properties-editor/bde-properties-editor.html">

<dom-module id="bde-dataflow-view">
  <template>
    <style>
      :host {
        position: relative;
        display: block;
      }

      #graph {
        @apply(--layout);
        @apply(--layout-vertical);

        width: 100%;
        height: 100%;
      }

      #toolbar {
        position: absolute;
        bottom: 1em;
        width: 100%;

        @apply(--layout-horizontal);
      }

      paper-fab {
        margin: 0 1em;
      }

      #zoomToFit,
      #triggerAutolayout {
        --paper-fab-background: var(--light-primary-color);
      }

      .flex {
        @apply(--layout-flex);
      }

      #addCubble {
        z-index: 10;
        transition: transform ease-in-out 0.3s;
      }

      #addCubble.moveRight {
        transform: translate3d(calc(28px + 1em),0,0);

        @apply(--shadow-elevation-3dp);
      }

      #drawerPanel {
        --paper-drawer-panel-right-drawer-container: {
          background-color: var(--paper-grey-100);
          padding: 20px;
          overflow-y: auto;
          z-index: 1;

          @apply(--shadow-elevation-2dp);
        };
      }

      #dialog {
        width: 50%;
        min-width: 500px;
      }
    </style>

    <paper-dialog id="dialog" opened="{{dialogOpened}}" with-backdrop>

      <h2>Add Cubble</h2>

      <paper-dialog-scrollable>

        <bde-base-browser id="browser"
          on-iron-selected="_addCubble"
        ></bde-base-browser>

      </paper-dialog-scrollable>

      <div class="buttons">
        <paper-button dialog-dismiss>Close</paper-button>
      </div>

    </paper-dialog>

    <paper-drawer-panel id="drawerPanel"
      drawer-width="400px"
      right-drawer
      force-narrow="[[!showPropertyEditor]]"
      disable-swipe
      disable-edge-swipe>

      <div id="mainPanel" main>

        <bde-graph id="graph"
          graph="{{graph}}"
          width="[[_graphWidth]]"
          height="[[_graphHeight]]"
          offset-x="[[_graphOffsetX]]"
          offset-y="[[_graphOffsetY]]"
          theme="light"
          selected-nodes="{{selectedNodes}}"
          selected-edges="{{selectedEdges}}"
          last-selected-node="{{lastSelectedNode}}"
          last-selected-edge="{{lastSelectedEdge}}"
        ></bde-graph>

        <div id="toolbar">
          <paper-fab id="zoomToFit"
            icon="icons:aspect-ratio"
            on-tap="zoomToFit"
          ></paper-fab>

          <paper-fab id="triggerAutolayout"
            icon="bde:magic-wand"
            on-tap="triggerAutolayout"
          ></paper-fab>

          <div class="flex"></div>

          <paper-fab id="addCubble"
            class$="[[_addCubbleClass(showPropertyEditor)]]"
            icon="icons:add"
            active="{{dialogOpened}}"
            toggles
            ></paper-fab>
        </div>

      </div>

      <div id="drawerPanel" drawer>

        <bde-properties-editor id="propertyEditor"
          members="[[selectedMembers]]"
          connections="[[selectedConnections]]"
        ></bde-properties-editor>

      </div>

    </paper-drawer-panel>

</template>
<!-- Fetch API polyfill -->
<script src="../../vendor/fetch/fetch.js"></script>
<script src="./bde-dataflow-view.js"></script>
</dom-module>
