<!-- libraries -->
<link rel="import" href="../../vendor/polymer/polymer.html">

<!-- paper elements -->
<link rel="import" href="../../vendor/paper-input/paper-input.html"/>
<link rel="import" href="../../vendor/paper-button/paper-button.html"/>
<link rel="import" href="../../vendor/paper-dialog/paper-dialog.html"/>
<link rel="import" href="../../vendor/paper-item/paper-item.html"/>
<link rel="import" href="../../vendor/paper-menu/paper-menu.html"/>

<!-- iron elements -->
<link rel="import" href="../../vendor/iron-form/iron-form.html"/>
<link rel="import" href="../../vendor/iron-flex-layout/iron-flex-layout.html"/>

<!-- neon elements -->
<link rel="import" href="../../vendor/neon-animation/animations/fade-out-animation.html">

<!--
A BDE custom-element, functioning as an input-form for the required webpackage metadata.
It is presented in a dialog, submitting the data as a generalData object.

NOTE: modelVersion, webpackageType and license (defined in webpackageDocument specification) are set in the bde-webpackdoc-creator element.

Example:

    <bde-webpackdoc-input
        name="{{generalData.name}}"
        group-id="{{generalData.groupId}}"
        version="{{generalData.version}}"
        description="{{generalData.description}}"
        author="{{generalData.author}}"
        email="{{generalData.email}}"
        keywords="{{generalData.keywords}}">
    </bde-webpackdoc-input>

@group BDE Custom Elements
@element bde-webpackdoc-input
@demo ..\elements\bde-webpackdoc-input\demo\index.html Demo for bde-webpackdoc-input.
-->

<dom-module id="bde-webpackdoc-input">

    <template>
        <style>
            :host {
                display: block;
                font-family: 'Roboto Mono', 'Consolas', 'Menlo', monospace;
            }

            :host .formButton {
                float: right;
                padding: 10px
            }

        </style>

        <paper-dialog opened="{{open}}" with-backdrop exit-animation="fade-out-animation" closeSelector="[dismissive]">
            <h3>Project Properties</h3>

            <form is="iron-form" id="webpackdocForm" method="get" contentType="application/json">

                <div class="layout horizontal">
                    <paper-input
                        name="groupId"
                        value="{{groupId}}"
                        label="groupId"
                        pattern="(?:\S+\.)+\S+"
                        error-message="groupid must contain a dot"
                        auto-validate
                        required>
                    </paper-input>
                    <paper-input
                        name="name"
                        value="{{name}}"
                        label="name"
                        pattern="\w+(?:-\w+)+"
                        error-message="name must contain a dash"
                        auto-validate
                        required>
                    </paper-input>
                    <paper-input
                        name="version"
                        value="{{version}}"
                        label="version"
                        pattern="(\d+\.)?(\d+\.)(\d+)(-\S+)?"
                        error-message="version must follow this pattern '0.0.1' "
                        auto-validate
                        required>
                    </paper-input>
                </div>

                <div class="layout horizontal">
                  <paper-input
                  name="description"
                  class="flex"
                  value="{{description}}"
                  label="description"
                  char-counter
                  maxlength="200">
                </paper-input>
                </div>

                <div class="layout horizontal">
                    <paper-input
                        name="author"
                        class="flex"
                        value="{{author}}"
                        label="author"
                        pattern="(?:\S+\s)+\S+"
                        error-message="enter a valid author name"
                        auto-validate
                        required>
                    </paper-input>
                    <paper-input
                        name="email"
                        class="flex"
                        value="{{email}}"
                        label="email"
                        type="email"
                        pattern="[^@]+@[^@]+\.[a-zA-Z]{2,6}"
                        error-message="enter a valid email"
                        auto-validate
                        required>
                    </paper-input>
                </div>

                <paper-input name="keywords" label="keywords" value="{{keywords}}"
                             on-blur="handleKeyword"></paper-input>

                <paper-button
                    class="formButton"
                    dialog-confirm
                    on-tap="submitForm"> Submit
                </paper-button>
                <paper-button class="formButton" dialog-dismiss> Close</paper-button>
            </form>
        </paper-dialog>
    </template>

</dom-module>

<script>

    Polymer({

        is : 'bde-webpackdoc-input',

        properties : {
            /**
             * Property binding to the opened attribute of the dialog, to open the input-form.
             *
             * @property open
             * @type {Boolean}
             */
            open : Boolean,

            /**
             * Property for groupid input. Follows a regEx for a mandatory '.'
             *
             * @property groupid
             * @type {String}
             */
            groupId : {
                type: String,
                value: 'com.default'
            },

            /**
             * Property for name input. Follows a regEx for a mandatory '-'
             *
             * @property name
             * @type {String}
             */
            name : {
                type: String,
                value: 'new-compound'
            },

            /**
             * Property for version input. Follows a regEx to allow digits, divided by '.' and a suffix like 'SNAPSHOT'.
             *
             * @property version
             * @type {String}
             */
            version : {
                type: String,
                value: '0.1-SNAPSHOT'
            },

            /**
             * Property for description input.
             *
             * @property description
             * @type {String}
             */
            description : String,

            /**
             * Property for author input.
             *
             * @property author
             * @type {String}
             */
            author : {
                type: String,
                value: ''
            },

            /**
             * Property for email input. Follows a RegEx to validate for email format.
             *
             * @property email
             * @type {String}
             */
            email : {
                type: String,
                value: ''
            },

            /**
             * Property for keyword input.
             *
             * @property keywords
             * @type {String}
             */
            keywords : String,

            /**
             * Metadata for the created compound component. Notifies it's data for databinding.
             *
             * @property generalData
             * @type {Object}
             */
            generalData: {
                type: Object,
                notify: true
            }
        },

        /**
         * Checks for validity of the form before submitting the data.
         *
         * @method submitForm
         * @param evt
         */
        submitForm : function (evt) {
            if (this.$.webpackdocForm.validate() == false) {
                evt.stopPropagation();
            } else {
                // generalData are set here, the application/other elements can bind to this property
                this.set('generalData', this.$.webpackdocForm.serialize());
                this.fire('docInput.submit', {data : this.$.webpackdocForm.serialize()});
            }
        },

        /**
         * Handles the keyword input, separates items by comma and space in the view.
         *
         * @method handleKeyword
         * @return {Array|keywords} A list of keywords.
         */
        handleKeyword : function () {
            this.keywords = this.keywords.toString().split(/[ ,]+/);
            return this.keywords
        }
    });

</script>
